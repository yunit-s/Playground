<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>음성인식 성능 테스트</title>
    <link rel="stylesheet" th:href="@{/css/upload.css}">
    <link rel="stylesheet" th:href="@{/css/toast.css}">
</head>
<body>
    <div class="container">
        <h1>음성인식 성능 테스트</h1>

        <form id="uploadForm" method="POST" action="/upload" enctype="multipart/form-data">
            <!-- Hidden file inputs for form submission -->
            <input type="file" id="wavFiles" name="files" multiple accept=".wav" style="display: none;">
            <input type="file" id="txtFiles" name="files" multiple accept=".txt" style="display: none;">

            <div class="drop-zone-container">
                <div class="drop-zone-wrapper">
                    <h3 class="upload-title">음성 파일 (WAV)</h3>
                    <div id="wav-drop-zone" class="drop-zone">
                        <p>여기에 파일을 드래그 앤 드롭하거나, 이 영역을 클릭하세요.</p>
                    </div>
                    <ul id="wav-file-list" class="file-list">
                        <!-- WAV files will be listed here -->
                    </ul>
                </div>

                <div class="drop-zone-wrapper">
                    <h3 class="upload-title">정답 텍스트 파일 (TXT)</h3>
                    <div id="txt-drop-zone" class="drop-zone">
                        <p>여기에 파일을 드래그 앤 드롭하거나, 이 영역을 클릭하세요.</p>
                    </div>
                    <ul id="txt-file-list" class="file-list">
                        <!-- TXT files will be listed here -->
                    </ul>
                </div>
            </div>

            <button type="submit">STT 실행</button>
        </form>

        <div th:if="${cerResults}" class="cer-results-section">
            <h2>STT 실행 결과</h2>

            <div th:if="${totalCerResult}" class="total-results-summary">
                <h3>전체 요약 결과</h3>
                <p>전체 데이터 CER: <span th:text="${#numbers.formatDecimal(totalCerResult.totalCer, 1, 4)}"></span></p>
                <p>총 대체 텍스트(S): <span th:text="${totalCerResult.totalSubstitutions}"></span></p>
                <p>총 삭제 텍스트(D): <span th:text="${totalCerResult.totalDeletions}"></span></p>
                <p>총 삽입 텍스트(I): <span th:text="${totalCerResult.totalInsertions}"></span></p>
                <p>총 참조 텍스트 길이(N): <span th:text="${totalCerResult.totalReferenceLength}"></span></p>
            </div>

            <div class="download-section" style="text-align: right; margin-bottom: 15px;">
                <a th:href="@{/download}" class="button">Excel 다운로드</a>
            </div>
            <table class="cer-table">
                <thead>
                    <tr>
                        <th>파일</th>
                        <th>참조 텍스트(정답 텍스트)</th>
                        <th>가설 텍스트(STT 결과)</th>
                        <th>CER</th>
                        <th>S</th>
                        <th>D</th>
                        <th>I</th>
                        <th>N</th>
                        <!-- <th>CER(B)</th> -->
                        <!-- <th>S(B)</th> -->
                        <!-- <th>D(B)</th> -->
                        <!-- <th>I(B)</th> -->
                        <!-- <th>N(B)</th> -->
                        <th>오류</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="result : ${cerResults}">
                        <td th:text="${result.originalFileName}"></td>
                        <td th:text="${result.referenceText}"></td>
                        <td th:text="${result.hypothesisText}"></td>
                        <td th:text="${#numbers.formatDecimal(result.cerModeA, 1, 4)}"></td>
                        <td th:text="${result.substitutionsModeA}"></td>
                        <td th:text="${result.deletionsModeA}"></td>
                        <td th:text="${result.insertionsModeA}"></td>
                        <td th:text="${result.referenceLengthModeA}"></td>
                        <!-- <td th:text="${#numbers.formatDecimal(result.cerModeB, 1, 4)}"></td> -->
                        <!-- <td th:text="${result.substitutionsModeB}"></td> -->
                        <!-- <td th:text="${result.deletionsModeB}"></td> -->
                        <!-- <td th:text="${result.insertionsModeB}"></td> -->
                        <!-- <td th:text="${result.referenceLengthModeB}"></td> -->
                        <td th:text="${result.errorMessage}"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <script th:src="@{/js/toast.js}"></script>
    <script th:src="@{/js/upload.js}"></script>

    <!-- Toast Notification Container -->
    <div id="toast-container"></div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        const message = /*[[${message}]]*/ null;
        if (message) {
            // This function will be defined in upload.js
            showToast(message, message.includes('성공') ? 'success' : 'error');
        }
        /*]]>*/
    </script>
</body>
</html>
